$(document).ready(function(){
  $("#main_image_modal").html("<%= j render(partial: 'modal_form') %>");
  $("#image-picker_att").imagepicker();
  $("#main_image_modal").modal("show");

  $("#image_upload, #image_picker").click(function() {
    if (this.id == "image_upload") {
      $("#image_upload").toggleClass("clicked_img");
      $("#image_picker").removeClass("clicked_img");
    } else if (this.id == "image_picker") {
      $("#image_picker").toggleClass("clicked_img");
      $("#image_upload").removeClass("clicked_img");
    }
  });

  $('#attachment_attachment').change(
    function () {
      if ($(this).val()) {
        $('input:submit').attr('disabled', false);
      }
    }
  )
  // $('#search_att').on("blur", function () {

  $("select#image-picker_att").imagepicker({
    hide_select: true,
    selected: function(option) {
      var value = this.val();
      $("#selection-image").click(function() {
        if (this.id == "selection-image") {
          if (value >= 1) {
            $("#main_image, #main_image_nil").text("Imagen seleccionada");
            var image_src = $('select option[value="'+ value + '"]')[0].dataset.imgSrc;
            $("#image_preview").attr("src", image_src);
          }
          $("#main_image_modal").modal("toggle");
          $("#post_main_image_id").val(value);
        }
      });
    }
  });

  $( "#btn_search" ).click(function() {
    var query = $('#search_att').val();
    $.ajax({
      type: "GET",
      url: "/admin/searchatt",
      data: {
        search: query
      },
      success: function (result) {
        var imgpicker = $("#image-picker_att");
        imgpicker.html('');
        $(result['data']).each(function() {
          imgpicker.append($("<option>").attr('value',this.val).text(this.name).attr('data-img-src', this['data-img-src']));
        })
        imgpicker.data('picker').destroy();
        imgpicker.imagepicker();
        $("select#image-picker_att").imagepicker({
          hide_select: true,
          selected: function(option) {
            var value = this.val();
            $("#selection-image").click(function() {
              if (this.id == "selection-image") {
                if (value >= 1) {
                  $("#main_image, #main_image_nil").text("Imagen seleccionada");
                  var image_src = $('select option[value="'+ value + '"]')[0].dataset.imgSrc;
                  $("#image_preview").attr("src", image_src);
                }
                $("#main_image_modal").modal("toggle");
                $("#post_main_image_id").val(value);
              }
            })
          }
        });
      }
    })
  })
});