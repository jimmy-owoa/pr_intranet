<% survey_data = @survey.questions.includes(:options, :answers).map{
  |i| {
    question_id: i.id, 
    question_name: i.title, 
    total_count: i.answers.count,
    option: i.options.map{
      |option| {option_name: option.title, count: option.answers.count}
    }
  }
} %>  
<div class="container">
  <div class="row title_form">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header" align="center">
          <div>
            <h2> <strong> <%= @survey.name %> </strong> </h2>
          </div>
        </div>
        <div class="card-body">
            <h4>Total de respuestas: <%= survey_data.map{|a| a[:total_count]}.inject(:+) %> </h4>
          <p class="card-text">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Pregunta </th>
                    <th scope="col">Total pregunta</th>
                    <th scope="col">Opciones </th>
                  </tr>
                </thead>
                <tbody>       
                  <% survey_data.each do |survey| %>       
                    <tr>
                      <td><%= survey[:question_name] %></td>
                      <td><%= survey[:total_count] %></td>
                      <td><%= survey[:option].map{|option| [option[:option_name], option[:count] ].join(': ')}.join(' , ') %></td>
                      </td>
                    </tr>
                  <% end %>
                </tbody>  
              </table>
            </div>
          </p>
      </div>
    </div>
  </div>
</div>
